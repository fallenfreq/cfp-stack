# Tech Stack Monorepo

## Overview

This repository is a monorepo for a web application using a modern tech stack. It includes:

- **TypeScript**
- **Vue 3**
- **Vuestic UI**
- **PrimeVue (unstyled with Tailwind)**
- **Tailwind CSS**
- **Vite**
- **Zitadel**
- **tRPC**
- **Drizzle ORM**
- **Docker**
- **Nginx**

## Setup

### Certificates

Ensure that `privkey.pem` and `fullchain.pem` certificates exist in the `./certs` directory. For development purposes, you can generate a certificate authority and self-signed certificates using the scripts provided in the `./certs` directory. Donâ€™t forgot to let your OS or browser trust your CA file.

### Environment Variables

Create a copy of any `.example` files and fill them in, removing the `.example` extension. For example, `.env.example` becomes `.env`. The defaults in the .example are fine for testing out the project other than a few variables that are mention in the authentication section.

### Authentication

Zitadel needs to be running for the login button to work.
You'll also need to login to the Zitadel console, create a Vue app to login to, create an API app for the API to do token inspection and add the appropriate `.env` vars to the client and API `.env` files.

#### Create Login App

- Go to`https://localhost:4443`
- Create a project and save the Resource ID as `VITE_API_PROJECT_RESOURCE_ID` in the client `.env` file
- Add a new application and select User Agent then PKCE for an SPA
- Add `https://localhost/auth/signinwin/zitadel` and `https://localhost:5173/auth/signinwin/zitadel` as Redirct URIs
- Add `https://localhost:5173/` and `https://localhost/` as Post Logout URIs
- Save the Client ID as `VITE_API_CLIENT_ID` in the client `.env`

#### Create Token Inspection App

- Go to`https://localhost:4443`
- Go to your previously created project
- Add a new application and select API then Basic for the tRPC API
- Save the client id and client secret as `ZITADEL_CLIENT_ID` and `ZITADEL_CLIENT_SECRET` in the api `.env` file

You can see more information on how to login to a single page application with Zitadel [here](https://zitadel.com/docs/examples/login/vue).

You can see more information on how we secure the API routes with Zitadel via token inspection and how to set up the API app in Zitadel [here](https://zitadel.com/blog/testing-token-introspection-with-postman).

### tRPC Endpoints

Prefix the tRPC endpoints with `/trpc`. Unprefixed URLs will serve the client and client assets.

#### Example tRPC Endpoint:

[https://localhost/trpc/echo?batch=1&input=%7B%220%22%3A%7B%22json%22%3A%7B%22name%22%3A%22from%20tRPC%22%7D%7D%7D](https://localhost/trpc/echo?batch=1&input=%7B%220%22%3A%7B%22json%22%3A%7B%22name%22%3A%22from%20tRPC%22%7D%7D%7D)

There is, however, no need to visit tRPC endpoints manually since you make queries using tRPC instead of something like Axios.

```typescript
trpc.secure.test
  .query('Sending data to tRPC secure endpoint from Vue client')
  .then((response) => {
    console.log('tRPC secure response', response)
  })
  .catch((error) => {
    console.log(error)
  })
```

#### Example Vue Route:

[https://localhost/vuestic-demo](https://localhost/vuestic-demo)

## Development Commands

- **Start Zitadel:** `pnpm docker:up:zitadel`
- **Start Development Database:** `pnpm db:api`
- **Install Dependencies:** `pnpm install --shamefully-hoist`
- **Build API and Client:** `pnpm build`
- **Start API and Vite Dev Server:** `pnpm dev`

### Ports

- Zitadel: `https://localhost:4443`
- Vite Dev Server: `https://localhost:5173`
- The main server which serves the Vite build files and the tRPC API uses the default https port of 443 so you can omit the port number. `https://localhost`

## Integration Details

The framework currently integrates Vuestic and PrimeVue.

### Tailwind and PrimeVue

PrimeVue components are unstyled and used with Tailwind. We cannot use `tailwindcss-primeui` until PrimeVue v4 supports Tailwind presets.

- [Tailwind CSS PrimeUI](https://github.com/primefaces/tailwindcss-primeui)
- [PrimeVue Tailwind](https://primevue.org/tailwind/)

### Tailwind and Vuestic

Read more about integrating Tailwind with Vuestic [here](https://ui.vuestic.dev/styles/tailwind).

The `client/cssVariables.js` file is generated by `client/plugins/extractCssVars.ts` so that variables can be accessed and passed to the `vuestic.config.js` to avoid duplicating color definitions. The Vuestic commands below might override the `vuestic.config.js` file, which should be avoided.

#### Synchronisation Commands:

- **Sync Tailwind with Vuestic:** `npx sync-tailwind-with-vuestic`

  - Formats and transfers the color and breakpoint settings from `tailwind.config.*` to `vuestic.config.js`.

- **Watch Tailwind Config:** `npx watch-tailwind`

  - Watches `tailwind.config.*` in the background and synchronizes the Vuestic UI configuration on the fly.

- **Sync Vuestic with Tailwind:** `npx sync-vuestic-with-tailwind`
  - Transfers color and breakpoint settings from the default Vuestic UI config to the Tailwind configuration file (`tailwind.config.cjs`).

## Themes

There's currently a dark mode, light mode and secret pink mode, press cmd+k to toggle pink mode. The secret pink mode was just to test if more than 2 themes could be implemented efficiently with the current configuration without changing the dark mode switch which starts based on os preference.

### Docker

Run `docker-compose up` to start Zitadel, the necessary databases, and the API, which also serves the Vue 3 client. Docker is intended as an option for deploying the API and sits behind Nginx as a reverse proxy. Zitadel is always started as a container and has its own network, including Nginx, databases, etc.

## Contributions

We welcome contributions! Please feel free to fork this repository and submit pull requests, make feature requests, report bugs or ask questions.
